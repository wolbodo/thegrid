<!doctype html>

<meta name="viewport" content="width=device-width, initial-scale=1">


<h1>Pong</h1> 

<script>

var ws = new WebSocket("ws://" + location.host + "/socket");

ws.onopen = function() {
   ws.send("helo");
};
ws.onmessage = function (evt) {
   var data;
   try {
   	data = JSON.parse(evt.data);
   } catch (e) {
   	data = evt.data
   }

   console.log('msg', data);
   if (data === 'msg GOGOGOGOGO...') {
   	(function() {
   	  var x = 0;

   	  function send() {
	   	 ws.send(JSON.stringify({
	   	 	position: x
	   	 }))
	   	 x ++;
	   	 if (x === 11) {
	   	 	x = 0;
	   	 }
	   	 window.setTimeout(send, 100);
   	  } 		
   	 window.setTimeout(send, 100);
   	})()
   }
};

</script>